<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anfitrion MX - Calculadora para Anfitriones</title>
    <meta name="description" content="Calcula tu ganancia neta real en Airbnb, Vrbo y Booking.">
    <meta name="theme-color" content="#10b981">
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" type="image/png" href="/icon-192.png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; }
        input[type=number] { -moz-appearance: textfield; }
        
        :root {
            --bg-primary: #020617;
            --bg-secondary: #0f172a;
            --bg-card: #0f172a;
            --border: #1f2937;
            --border-light: #374151;
            --text-primary: #f9fafb;
            --text-secondary: #9ca3af;
            --text-muted: #6b7280;
            --accent: #22c55e;
            --accent-hover: #16a34a;
            --success: #10b981;
            --warning: #fbbf24;
            --danger: #f87171;
        }
        
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg-primary); color: var(--text-primary); line-height: 1.5; min-height: 100vh; font-size: 16px; }
        .container { max-width: 480px; margin: 0 auto; padding: 16px; }
        
        .header { text-align: center; padding: 24px 0 16px; }
        .header h1 { font-size: 22px; font-weight: 700; color: var(--accent); margin-bottom: 4px; }
        .header p { color: var(--text-secondary); font-size: 14px; }
        
        .lang-toggle { display: flex; justify-content: center; gap: 8px; margin-bottom: 16px; }
        .lang-btn { padding: 8px 16px; border: 1px solid var(--border-light); border-radius: 20px; background: var(--bg-secondary); color: var(--text-secondary); font-size: 14px; cursor: pointer; transition: all 0.2s; }
        .lang-btn.active { border-color: var(--accent); color: var(--accent); background: rgba(34,197,94,0.1); }
        
        .currency-toggle { display: flex; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 12px; padding: 4px; margin-bottom: 16px; }
        .currency-btn { flex: 1; padding: 12px; border: none; background: transparent; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer; color: var(--text-secondary); transition: all 0.2s; }
        .currency-btn.active { background: var(--accent); color: var(--bg-primary); }
        
        .exchange-rate { text-align: center; font-size: 12px; color: var(--text-muted); margin-bottom: 16px; }
        
        .card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; padding: 20px; margin-bottom: 16px; }
        .card-title { font-size: 15px; font-weight: 600; margin-bottom: 16px; color: var(--text-primary); }
        
        .form-group { margin-bottom: 16px; }
        .form-label { display: block; font-size: 15px; font-weight: 600; color: var(--text-secondary); margin-bottom: 6px; }
        .form-input, .form-select { width: 100%; padding: 14px 16px; border: 1px solid var(--border-light); border-radius: 12px; font-size: 17px; background: var(--bg-primary); color: var(--text-primary); }
        .form-input:focus, .form-select:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 2px rgba(34,197,94,0.2); }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        
        .platform-selector { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; margin-bottom: 16px; }
        .platform-btn { padding: 10px 4px; border: 1px solid var(--border-light); border-radius: 12px; background: var(--bg-primary); color: var(--text-secondary); font-size: 13px; font-weight: 700; cursor: pointer; text-align: center; transition: all 0.2s; }
        .platform-btn.active { border-color: var(--accent); color: var(--accent); background: rgba(34,197,94,0.1); }
        .platform-fee { font-size: 9px; color: var(--text-muted); display: block; margin-top: 2px; }
        
        .btn-calculate { width: 100%; padding: 16px; background: var(--accent); color: var(--bg-primary); border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.2s; box-shadow: 0 0 20px rgba(34,197,94,0.3); margin-bottom: 24px; }
        .btn-calculate:hover { background: var(--accent-hover); box-shadow: 0 0 30px rgba(34,197,94,0.5); }
        
        .results { display: none; }
        .results.show { display: block; }
        
        /* Hero copiado de a-c */
        .result-hero { 
            background: linear-gradient(135deg, #0f172a 0%, #020617 100%); 
            border: 2px solid var(--success); 
            border-radius: 16px; 
            padding: 1.5rem; 
            text-align: center; 
            margin-bottom: 20px;
        }
        .result-hero-label { font-size: 1rem; color: var(--text-secondary); display: block; margin-bottom: 0.5rem; }
        .result-hero-amount { font-size: 2.75rem; font-weight: 700; color: var(--success); line-height: 1.2; }
        .result-hero-amount .moneda { font-size: 1rem; color: var(--text-secondary); margin-left: 0.25rem; }
        .result-hero-secondary { font-size: 0.95rem; color: var(--text-muted); margin-top: 0.25rem; }
        
        .credit-counter { text-align: center; padding: 10px 16px; border-radius: 8px; font-size: 14px; font-weight: 600; color: white; margin-bottom: 12px; }
        
        .btn-pdf { width: 100%; padding: 14px; background: var(--bg-secondary); border: 1px solid var(--border); color: var(--text-primary); border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 12px; transition: all 0.2s; }
        .btn-pdf:hover { border-color: var(--accent); color: var(--accent); }
        
        .btn-desglose { width: 100%; padding: 12px; background: transparent; border: 1px solid var(--border-light); color: var(--text-secondary); border-radius: 12px; font-size: 14px; cursor: pointer; margin-bottom: 16px; transition: all 0.2s; }
        .btn-desglose:hover { border-color: var(--accent); color: var(--accent); }
        
        .desglose-wrapper { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
        .desglose-wrapper.expanded { max-height: 2000px; }
        
        .result-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border); }
        .result-row:last-child { border-bottom: none; }
        .result-label { font-size: 14px; color: var(--text-secondary); }
        .result-value { font-size: 14px; font-weight: 600; color: var(--text-primary); }
        .result-value.negative { color: var(--danger); }
        .result-value.positive { color: var(--success); }
        
        .nota-pv { background: var(--bg-secondary); border-left: 4px solid var(--warning); border-radius: 0 12px 12px 0; padding: 16px; margin-bottom: 16px; display: none; }
        .nota-pv.visible { display: block; }
        .nota-pv-header { display: flex; align-items: center; gap: 8px; cursor: pointer; }
        .nota-pv-titulo { font-weight: 600; color: var(--warning); font-size: 14px; }
        .nota-pv-arrow { margin-left: auto; color: var(--text-muted); transition: transform 0.2s; }
        .nota-pv.open .nota-pv-arrow { transform: rotate(180deg); }
        .nota-pv-body { display: none; margin-top: 12px; }
        .nota-pv.open .nota-pv-body { display: block; }
        .nota-pv-body p { font-size: 13px; color: var(--text-secondary); margin-bottom: 8px; line-height: 1.5; }
        .nota-pv-body .disclaimer { color: var(--text-muted); font-style: italic; }
        .nota-pv-link { color: var(--accent); font-size: 13px; cursor: pointer; }
        
        .disclaimer { margin-top: 16px; padding: 16px; background: rgba(251,191,36,0.1); border-left: 4px solid var(--warning); border-radius: 8px; font-size: 13px; color: var(--warning); }
        
        .footer { text-align: center; padding: 24px 0; color: var(--text-muted); font-size: 12px; }
        .footer a { color: var(--accent); text-decoration: none; }
        
        .install-banner { display: none; background: linear-gradient(135deg, var(--accent) 0%, var(--accent-hover) 100%); color: var(--bg-primary); padding: 16px; border-radius: 12px; margin-bottom: 16px; align-items: center; justify-content: space-between; }
        .install-banner.show { display: flex; }
        .install-btn { padding: 8px 16px; background: var(--bg-primary); color: var(--accent); border: none; border-radius: 8px; font-weight: 600; cursor: pointer; }
        
        @media (max-width: 400px) { .platform-selector { grid-template-columns: repeat(3, 1fr); } .result-hero-amount { font-size: 2.25rem; } }
    </style>
</head>
<body>
    <div class="container">
        <header class="header"><h1>üè† Anfitrion MX</h1><p id="subtitle">Calculadora para Anfitriones</p></header>
        <div class="lang-toggle"><button class="lang-btn active" data-lang="es">üá≤üáΩ ES</button><button class="lang-btn" data-lang="en">üá∫üá∏ EN</button></div>
        <div class="install-banner" id="installBanner"><p id="installText">üì≤ Instala la app</p><button class="install-btn" id="installBtn">Instalar</button></div>
        <div class="currency-toggle"><button class="currency-btn active" data-currency="MXN">üá≤üáΩ Pesos MXN</button><button class="currency-btn" data-currency="USD">üá∫üá∏ D√≥lares USD</button></div>
        <div class="exchange-rate" id="exchangeRate">Cargando tipo de cambio...</div>
        
        <div class="card">
            <h2 class="card-title" id="cardTitleReserva">üìã Datos de la reserva</h2>
            <div class="form-group"><label class="form-label" id="labelPlataforma">Plataforma</label>
                <div class="platform-selector">
                    <button class="platform-btn active" data-platform="airbnb">Airbnb<span class="platform-fee">3%</span></button>
                    <button class="platform-btn" data-platform="airbnb15">Airbnb<span class="platform-fee">15%</span></button>
                    <button class="platform-btn" data-platform="vrbo">Vrbo<span class="platform-fee">8%</span></button>
                    <button class="platform-btn" data-platform="booking">Booking<span class="platform-fee">15%</span></button>
                    <button class="platform-btn" data-platform="directa">Directa<span class="platform-fee">0%</span></button>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group"><label class="form-label" id="labelTarifa">Tarifa por noche</label><input type="number" class="form-input" id="tarifaNoche" placeholder="2,000" min="0"></div>
                <div class="form-group"><label class="form-label" id="labelNoches">N√∫mero de noches</label><input type="number" class="form-input" id="numNoches" placeholder="3" min="1" value="1"></div>
            </div>
        </div>
        
        <div class="card">
            <h2 class="card-title" id="cardTitleFiscal">üíº R√©gimen fiscal</h2>
            <div class="form-group"><label class="form-label" id="labelRegimen">Tu r√©gimen fiscal</label>
                <select class="form-select" id="regimenFiscal"><option value="SIN_RFC">Sin RFC (retenci√≥n m√°xima)</option><option value="RESICO">RESICO</option><option value="ACT_EMPRESARIAL">Actividad Empresarial</option></select>
            </div>
            <div class="form-group"><label class="form-label" id="labelEstado">Estado donde est√° tu propiedad</label>
                <select class="form-select" id="estado"><option value="JALISCO">Jalisco (3% ISH - convenio Airbnb)</option><option value="CDMX">CDMX (5% ISH - convenio Airbnb)</option><option value="QROO">Quintana Roo (4% ISH - convenio Airbnb)</option><option value="YUCATAN">Yucat√°n (5% ISH - convenio Airbnb)</option><option value="BCS">Baja California Sur (5% ISH - convenio Airbnb)</option><option value="EDOMEX">Estado de M√©xico (3% ISH - convenio Airbnb)</option><option value="OAXACA">Oaxaca (3% ISH - convenio Airbnb)</option><option value="SINALOA">Sinaloa (3% ISH - convenio Airbnb)</option><option value="SONORA">Sonora (2% ISH - convenio Airbnb)</option><option value="CHIAPAS">Chiapas (2% ISH - convenio Airbnb)</option><option value="PUEBLA">Puebla (3% ISH - convenio Airbnb)</option><option value="GUERRERO">Guerrero (4% ISH - convenio Airbnb)</option><option value="NAYARIT">Nayarit (5% ISH - SIN convenio)</option><option value="BC">Baja California (5% ISH - SIN convenio)</option><option value="NL">Nuevo Le√≥n (3% ISH - SIN convenio)</option><option value="QUERETARO">Quer√©taro (2.5% ISH - SIN convenio)</option><option value="MICHOACAN">Michoac√°n (3% ISH - SIN convenio)</option><option value="COLIMA">Colima (2% ISH - SIN convenio)</option><option value="AGUASCALIENTES">Aguascalientes (3% ISH - SIN convenio)</option><option value="GUANAJUATO">Guanajuato (2% ISH - SIN convenio)</option><option value="SLP">San Luis Potos√≠ (3% ISH - SIN convenio)</option><option value="ZACATECAS">Zacatecas (3% ISH - SIN convenio)</option><option value="DURANGO">Durango (3% ISH - SIN convenio)</option><option value="COAHUILA">Coahuila (3% ISH - SIN convenio)</option><option value="TAMAULIPAS">Tamaulipas (3% ISH - SIN convenio)</option><option value="VERACRUZ">Veracruz (2% ISH - SIN convenio)</option><option value="HIDALGO">Hidalgo (3% ISH - SIN convenio)</option><option value="TLAXCALA">Tlaxcala (3% ISH - SIN convenio)</option><option value="MORELOS">Morelos (3% ISH - SIN convenio)</option><option value="TABASCO">Tabasco (2% ISH - SIN convenio)</option><option value="CAMPECHE">Campeche (2% ISH - SIN convenio)</option></select>
            </div>
        </div>
        
        <div class="card">
            <h2 class="card-title" id="cardTitleGastos">üí∏ Gastos operativos</h2>
            <div class="form-row">
                <div class="form-group"><label class="form-label" id="labelLimpiezaCobrada">Limpieza cobrada</label><input type="number" class="form-input" id="tarifaLimpieza" placeholder="500" min="0"></div>
                <div class="form-group"><label class="form-label" id="labelLimpiezaReal">Limpieza real</label><input type="number" class="form-input" id="gastoLimpieza" placeholder="300" min="0"></div>
            </div>
            <div class="form-group"><label class="form-label" id="labelConsumibles">Consumibles</label><input type="number" class="form-input" id="gastoConsumibles" placeholder="150" min="0"></div>
        </div>
        
        <button class="btn-calculate" id="btnCalcular"><span id="btnCalcularText">Ver cu√°nto me queda</span></button>
        
        <div class="results" id="results">
            <div class="result-hero">
                <span class="result-hero-label" id="labelGananciaNeta">üí∞ Tu ganancia neta</span>
                <div class="result-hero-amount"><span id="gananciaNeta">$0</span><span class="moneda">MXN</span></div>
                <div class="result-hero-secondary">‚âà <span id="gananciaNetaSecondary">$0</span> USD</div>
            </div>
            
            <div class="credit-counter" id="creditCounter">‚ö° 10 c√°lculos restantes</div>
            <button class="btn-pdf" id="btnDescargarPDF">üìÑ <span id="btnPdfText">Descargar PDF de c√°lculo desglosado</span></button>
            <button class="btn-desglose" id="btnDesglose"><span id="btnDesgloseText">‚ñº Ver desglose completo</span></button>
            <div class="nota-pv" id="notaPV"><div class="nota-pv-header" id="notaPVToggle"><span>‚ö†Ô∏è</span><span class="nota-pv-titulo" id="notaPVTitulo">Aviso: Puerto Vallarta 2026</span><span class="nota-pv-arrow">‚ñº</span></div><div class="nota-pv-body"><p id="notaPVTexto">La Ley de Ingresos de Puerto Vallarta 2026 contempla un impuesto de saneamiento ambiental (~$90 MXN/noche) que podr√≠a aplicar a rentas vacacionales.</p><p class="disclaimer" id="notaPVDisclaimer"><strong>Pendiente de confirmaci√≥n.</strong> Este impuesto a√∫n no se incluye en el c√°lculo.</p><span class="nota-pv-link" id="notaPVLink">M√°s informaci√≥n ‚Üí</span></div></div>
            <div class="desglose-wrapper" id="desgloseWrapper">
                <div class="card">
                    <div class="result-row"><span class="result-label" id="labelIngresoBruto">Ingreso bruto</span><span class="result-value positive" id="ingresoBruto">$0</span></div>
                    <div class="result-row"><span class="result-label">Comisi√≥n <span id="plataformaNombre">Airbnb</span></span><span class="result-value negative" id="comisionPlataforma">-$0</span></div>
                    <div class="result-row"><span class="result-label" id="labelRetencionISR">Retenci√≥n ISR</span><span class="result-value negative" id="retencionISR">-$0</span></div>
                    <div class="result-row"><span class="result-label" id="labelRetencionIVA">Retenci√≥n IVA</span><span class="result-value negative" id="retencionIVA">-$0</span></div>
                    <div class="result-row" id="rowIVAAdicional" style="display:none;"><span class="result-label" id="labelIVAAdicional">IVA adicional (8%)</span><span class="result-value negative" id="ivaAdicional">-$0</span></div>
                    <div class="result-row"><span class="result-label" id="ishLabel">ISH</span><span class="result-value" id="ishValor">$0</span></div>
                    <div class="result-row"><span class="result-label" id="labelGastoLimpieza">Limpieza</span><span class="result-value negative" id="gastoLimpiezaResult">-$0</span></div>
                    <div class="result-row"><span class="result-label" id="labelGastoConsumibles">Consumibles</span><span class="result-value negative" id="gastoConsumiblesResult">-$0</span></div>
                    <div class="result-row" style="border-top: 2px solid var(--border-light); margin-top: 8px; padding-top: 16px;"><span class="result-label" id="labelTotalDeducciones"><strong>Total deducciones</strong></span><span class="result-value negative" id="totalDeducciones"><strong>-$0</strong></span></div>
                </div>
            </div>
            <div class="disclaimer" id="disclaimer"><strong>‚ö†Ô∏è Importante:</strong> Esta herramienta ofrece c√°lculos aproximados con fines informativos. No constituye asesor√≠a fiscal, contable ni legal. Consulta a un contador certificado.</div>
        </div>
        <footer class="footer"><p>Hecho con üß° por <a href="#">Colmena</a> 2026</p></footer>
    </div>
    
    <script>
        const COMISIONES={airbnb:0.03,airbnb15:0.155,vrbo:0.08,booking:0.15,directa:0};
        const REGIMENES={SIN_RFC:{isr:0.20,iva:0.16,ivaAdicional:0},RESICO:{isr:0.04,iva:0.08,ivaAdicional:0.08},ACT_EMPRESARIAL:{isr:0.04,iva:0.08,ivaAdicional:0.08}};
        const ESTADOS={JALISCO:{ish:0.03,convenio:true},CDMX:{ish:0.05,convenio:true},QROO:{ish:0.04,convenio:true},YUCATAN:{ish:0.05,convenio:true},BCS:{ish:0.05,convenio:true},EDOMEX:{ish:0.03,convenio:true},OAXACA:{ish:0.03,convenio:true},SINALOA:{ish:0.03,convenio:true},SONORA:{ish:0.02,convenio:true},CHIAPAS:{ish:0.02,convenio:true},PUEBLA:{ish:0.03,convenio:true},GUERRERO:{ish:0.04,convenio:true},NAYARIT:{ish:0.05,convenio:false},BC:{ish:0.05,convenio:false},NL:{ish:0.03,convenio:false},QUERETARO:{ish:0.025,convenio:false},MICHOACAN:{ish:0.03,convenio:false},COLIMA:{ish:0.02,convenio:false},AGUASCALIENTES:{ish:0.03,convenio:false},GUANAJUATO:{ish:0.02,convenio:false},SLP:{ish:0.03,convenio:false},ZACATECAS:{ish:0.03,convenio:false},DURANGO:{ish:0.03,convenio:false},COAHUILA:{ish:0.03,convenio:false},TAMAULIPAS:{ish:0.03,convenio:false},VERACRUZ:{ish:0.02,convenio:false},HIDALGO:{ish:0.03,convenio:false},TLAXCALA:{ish:0.03,convenio:false},MORELOS:{ish:0.03,convenio:false},TABASCO:{ish:0.02,convenio:false},CAMPECHE:{ish:0.02,convenio:false}};
        const TEXTS={es:{subtitle:'Calculadora para Anfitriones',cardTitleReserva:'üìã Datos de la reserva',labelPlataforma:'Plataforma',labelTarifa:'Tarifa por noche',labelNoches:'N√∫mero de noches',cardTitleFiscal:'üíº R√©gimen fiscal',labelRegimen:'Tu r√©gimen fiscal',labelEstado:'Estado donde est√° tu propiedad',cardTitleGastos:'üí∏ Gastos operativos',labelLimpiezaCobrada:'Limpieza cobrada',labelLimpiezaReal:'Limpieza real',labelConsumibles:'Consumibles',btnCalcular:'Ver cu√°nto me queda',labelGananciaNeta:'üí∞ Tu ganancia neta',creditRemaining:' c√°lculos restantes',creditNone:'‚ö†Ô∏è Sin c√°lculos',btnPdf:'Descargar PDF de c√°lculo desglosado',btnDesglose:'‚ñº Ver desglose completo',btnDesgloseHide:'‚ñ≤ Ocultar desglose',labelIngresoBruto:'Ingreso bruto',labelTotalDeducciones:'Total deducciones',labelRetencionISR:'Retenci√≥n ISR',labelRetencionIVA:'Retenci√≥n IVA',labelIVAAdicional:'IVA adicional (8%)',labelGastoLimpieza:'Limpieza',labelGastoConsumibles:'Consumibles',disclaimer:'<strong>‚ö†Ô∏è Importante:</strong> Esta herramienta ofrece c√°lculos aproximados con fines informativos. No constituye asesor√≠a fiscal, contable ni legal. Consulta a un contador certificado.',exchangeRate:'TC: $1 USD = ${{rate}} MXN',airbnbPaga:'$0 (Airbnb lo paga)',notaPVTitulo:'Aviso: Puerto Vallarta 2026',notaPVTexto:'La Ley de Ingresos de Puerto Vallarta 2026 contempla un impuesto de saneamiento ambiental (~$90 MXN/noche) que podr√≠a aplicar a rentas vacacionales.',notaPVDisclaimer:'<strong>Pendiente de confirmaci√≥n.</strong> Este impuesto a√∫n no se incluye en el c√°lculo.',notaPVModal:'Impuesto de Saneamiento Ambiental - Puerto Vallarta 2026\n\n‚Ä¢ Monto: ~$90 MXN/noche\n‚Ä¢ Aplica a: Plataformas digitales\n\nPendiente de confirmaci√≥n.'},en:{subtitle:'Calculator for Hosts',cardTitleReserva:'üìã Reservation details',labelPlataforma:'Platform',labelTarifa:'Nightly rate',labelNoches:'Number of nights',cardTitleFiscal:'üíº Tax regime',labelRegimen:'Your tax regime',labelEstado:'Property location',cardTitleGastos:'üí∏ Operating expenses',labelLimpiezaCobrada:'Cleaning charged',labelLimpiezaReal:'Actual cleaning',labelConsumibles:'Supplies',btnCalcular:'See what I keep',labelGananciaNeta:'üí∞ Your net earnings',creditRemaining:' calculations left',creditNone:'‚ö†Ô∏è No calculations',btnPdf:'Download breakdown PDF',btnDesglose:'‚ñº View breakdown',btnDesgloseHide:'‚ñ≤ Hide breakdown',labelIngresoBruto:'Gross income',labelTotalDeducciones:'Total deductions',labelRetencionISR:'ISR withholding',labelRetencionIVA:'IVA withholding',labelIVAAdicional:'Additional IVA (8%)',labelGastoLimpieza:'Cleaning',labelGastoConsumibles:'Supplies',disclaimer:'<strong>‚ö†Ô∏è Important:</strong> Approximate calculations for informational purposes only. Not tax or legal advice. Consult an accountant.',exchangeRate:'FX: $1 USD = ${{rate}} MXN',airbnbPaga:'$0 (Airbnb pays)',notaPVTitulo:'Notice: Puerto Vallarta 2026',notaPVTexto:'Puerto Vallarta 2026 includes an environmental tax (~$90 MXN/night) that may apply to vacation rentals.',notaPVDisclaimer:'<strong>Pending confirmation.</strong> Not yet included in calculation.',notaPVModal:'Environmental Tax - Puerto Vallarta 2026\n\n‚Ä¢ Amount: ~$90 MXN/night\n‚Ä¢ Applies to: Digital platforms\n\nPending confirmation.'}};
        let currentLang='es',currentCurrency='MXN',tipoCambio=20.00,selectedPlatform='airbnb',lastCalculation=null,desgloseExpanded=false;
        function getCredits(){const c=localStorage.getItem('anfitrion_calculos');return c===null?10:parseInt(c);}
        function setCredits(n){localStorage.setItem('anfitrion_calculos',n);updateCreditDisplay();}
        function useCredit(){const c=getCredits();if(c>0){setCredits(c-1);return true;}return false;}
        function updateCreditDisplay(){
            const c=getCredits(),t=TEXTS[currentLang],el=document.getElementById('creditCounter');
            if(!el)return;
            if(c<=0){el.textContent=t.creditNone;el.style.background='#dc2626';}
            else{
                el.textContent='‚ö° '+c+t.creditRemaining;
                // Gradiente verde (10) ‚Üí rojo (1)
                if(c>=10)el.style.background='#10b981';
                else if(c===9)el.style.background='#22c55e';
                else if(c===8)el.style.background='#84cc16';
                else if(c===7)el.style.background='#a3e635';
                else if(c===6)el.style.background='#facc15';
                else if(c===5)el.style.background='#fbbf24';
                else if(c===4)el.style.background='#f97316';
                else if(c===3)el.style.background='#fb923c';
                else if(c===2)el.style.background='#f87171';
                else el.style.background='#ef4444';
            }
        }
        function updateLanguage(){const t=TEXTS[currentLang];document.getElementById('subtitle').textContent=t.subtitle;document.getElementById('cardTitleReserva').textContent=t.cardTitleReserva;document.getElementById('labelPlataforma').textContent=t.labelPlataforma;document.getElementById('labelTarifa').textContent=t.labelTarifa;document.getElementById('labelNoches').textContent=t.labelNoches;document.getElementById('cardTitleFiscal').textContent=t.cardTitleFiscal;document.getElementById('labelRegimen').textContent=t.labelRegimen;document.getElementById('labelEstado').textContent=t.labelEstado;document.getElementById('cardTitleGastos').textContent=t.cardTitleGastos;document.getElementById('labelLimpiezaCobrada').textContent=t.labelLimpiezaCobrada;document.getElementById('labelLimpiezaReal').textContent=t.labelLimpiezaReal;document.getElementById('labelConsumibles').textContent=t.labelConsumibles;document.getElementById('btnCalcularText').textContent=t.btnCalcular;document.getElementById('labelGananciaNeta').textContent=t.labelGananciaNeta;document.getElementById('btnPdfText').textContent=t.btnPdf;document.getElementById('btnDesgloseText').textContent=desgloseExpanded?t.btnDesgloseHide:t.btnDesglose;document.getElementById('labelIngresoBruto').textContent=t.labelIngresoBruto;document.getElementById('labelTotalDeducciones').innerHTML='<strong>'+t.labelTotalDeducciones+'</strong>';document.getElementById('labelRetencionISR').textContent=t.labelRetencionISR;document.getElementById('labelRetencionIVA').textContent=t.labelRetencionIVA;document.getElementById('labelIVAAdicional').textContent=t.labelIVAAdicional;document.getElementById('labelGastoLimpieza').textContent=t.labelGastoLimpieza;document.getElementById('labelGastoConsumibles').textContent=t.labelGastoConsumibles;document.getElementById('disclaimer').innerHTML=t.disclaimer;document.getElementById('notaPVTitulo').textContent=t.notaPVTitulo;document.getElementById('notaPVTexto').textContent=t.notaPVTexto;document.getElementById('notaPVDisclaimer').innerHTML=t.notaPVDisclaimer;updateExchangeRateDisplay();updateCreditDisplay();}
        async function fetchTipoCambio(){const cached=localStorage.getItem('tipoCambio'),cachedTime=localStorage.getItem('tipoCambioTime');if(cached&&cachedTime&&(Date.now()-parseInt(cachedTime))<3600000){tipoCambio=parseFloat(cached);updateExchangeRateDisplay();return;}try{const r=await fetch('/api/fx-usd');const d=await r.json();if(d.tipoCambio){tipoCambio=d.tipoCambio;localStorage.setItem('tipoCambio',tipoCambio.toString());localStorage.setItem('tipoCambioTime',Date.now().toString());}}catch(e){}updateExchangeRateDisplay();}
        function updateExchangeRateDisplay(){document.getElementById('exchangeRate').textContent=TEXTS[currentLang].exchangeRate.replace('{{rate}}',tipoCambio.toFixed(2));}
        function convertir(m,de,a){if(de===a)return m;if(de==='USD'&&a==='MXN')return m*tipoCambio;if(de==='MXN'&&a==='USD')return m/tipoCambio;return m;}
        function formatMoney(a,c){return new Intl.NumberFormat(currentLang==='es'?'es-MX':'en-US',{style:'currency',currency:c||'MXN',minimumFractionDigits:0,maximumFractionDigits:2}).format(a);}
        function calcular(){if(getCredits()<=0){alert(currentLang==='es'?'No tienes c√°lculos disponibles.':'No calculations available.');return;}let tarifaNoche=parseFloat(document.getElementById('tarifaNoche').value)||0,numNoches=parseInt(document.getElementById('numNoches').value)||1,tarifaLimpieza=parseFloat(document.getElementById('tarifaLimpieza').value)||0;const regimen=document.getElementById('regimenFiscal').value,estado=document.getElementById('estado').value;let gastoLimpieza=parseFloat(document.getElementById('gastoLimpieza').value)||0,gastoConsumibles=parseFloat(document.getElementById('gastoConsumibles').value)||0;if(currentCurrency==='USD'){tarifaNoche=convertir(tarifaNoche,'USD','MXN');tarifaLimpieza=convertir(tarifaLimpieza,'USD','MXN');gastoLimpieza=convertir(gastoLimpieza,'USD','MXN');gastoConsumibles=convertir(gastoConsumibles,'USD','MXN');}const ingresoBruto=(tarifaNoche*numNoches)+tarifaLimpieza,tasaComision=COMISIONES[selectedPlatform],comisionPlataforma=ingresoBruto*tasaComision;const regimenConfig=REGIMENES[regimen],retencionISR=ingresoBruto*regimenConfig.isr,retencionIVA=ingresoBruto*regimenConfig.iva,ivaAdicional=ingresoBruto*regimenConfig.ivaAdicional;const estadoConfig=ESTADOS[estado],ishCalculado=ingresoBruto*estadoConfig.ish,esAirbnb=selectedPlatform==='airbnb'||selectedPlatform==='airbnb15',ishAPagar=(esAirbnb&&estadoConfig.convenio)?0:ishCalculado;const totalGastos=gastoLimpieza+gastoConsumibles,totalDeducciones=comisionPlataforma+retencionISR+retencionIVA+ivaAdicional+ishAPagar+totalGastos,gananciaNeta=ingresoBruto-totalDeducciones;useCredit();lastCalculation={ingresoBruto,comisionPlataforma,retencionISR,retencionIVA,ivaAdicional,ishAPagar,tieneConvenio:esAirbnb&&estadoConfig.convenio,gastoLimpieza,gastoConsumibles,totalDeducciones,gananciaNeta,estado,regimen,plataforma:selectedPlatform};mostrarResultados(lastCalculation);const notaPV=document.getElementById('notaPV');if(estado==='JALISCO'){notaPV.classList.add('visible');}else{notaPV.classList.remove('visible');}}
        function mostrarResultados(data){const t=TEXTS[currentLang];document.getElementById('results').classList.add('show');document.getElementById('gananciaNeta').textContent=formatMoney(data.gananciaNeta,'MXN');document.getElementById('gananciaNetaSecondary').textContent=formatMoney(data.gananciaNeta/tipoCambio,'USD');document.getElementById('ingresoBruto').textContent=formatMoney(data.ingresoBruto,'MXN');document.getElementById('totalDeducciones').innerHTML='<strong>-'+formatMoney(data.totalDeducciones,'MXN')+'</strong>';const pn={airbnb:'Airbnb 3%',airbnb15:'Airbnb 15%',vrbo:'Vrbo',booking:'Booking',directa:'Directa'};document.getElementById('plataformaNombre').textContent=pn[selectedPlatform];document.getElementById('comisionPlataforma').textContent='-'+formatMoney(data.comisionPlataforma,'MXN');document.getElementById('retencionISR').textContent='-'+formatMoney(data.retencionISR,'MXN');document.getElementById('retencionIVA').textContent='-'+formatMoney(data.retencionIVA,'MXN');const rowIVA=document.getElementById('rowIVAAdicional');if(data.ivaAdicional>0){rowIVA.style.display='flex';document.getElementById('ivaAdicional').textContent='-'+formatMoney(data.ivaAdicional,'MXN');}else{rowIVA.style.display='none';}document.getElementById('ishLabel').textContent='ISH '+data.estado+' ('+(ESTADOS[data.estado].ish*100).toFixed(1)+'%)';document.getElementById('ishValor').textContent=data.tieneConvenio?t.airbnbPaga:'-'+formatMoney(data.ishAPagar,'MXN');document.getElementById('ishValor').className='result-value '+(data.tieneConvenio?'positive':'negative');document.getElementById('gastoLimpiezaResult').textContent='-'+formatMoney(data.gastoLimpieza,'MXN');document.getElementById('gastoConsumiblesResult').textContent='-'+formatMoney(data.gastoConsumibles,'MXN');document.getElementById('results').scrollIntoView({behavior:'smooth',block:'start'});}
        async function generatePDF(){if(!lastCalculation){alert('Calcula primero');return;}const btn=document.getElementById('btnDescargarPDF');btn.disabled=true;btn.innerHTML='‚è≥...';try{const data=lastCalculation,t=TEXTS[currentLang];const html=`<div style="font-family:Arial;padding:30px;background:#fff;color:#1e293b;width:500px;"><h2 style="text-align:center;color:#10b981;margin-bottom:24px;font-size:20px;border-bottom:2px solid #10b981;padding-bottom:10px;">üè† Anfitrion MX</h2><table style="width:100%;border-collapse:collapse;font-size:14px;"><tr style="background:#f1f5f9;"><td style="padding:12px;border:1px solid #cbd5e1;font-weight:600;">${t.labelIngresoBruto}</td><td style="padding:12px;border:1px solid #cbd5e1;text-align:right;color:#059669;font-weight:700;">${formatMoney(data.ingresoBruto,'MXN')}</td></tr><tr><td style="padding:12px;border:1px solid #cbd5e1;">Comisi√≥n</td><td style="padding:12px;border:1px solid #cbd5e1;text-align:right;color:#dc2626;">-${formatMoney(data.comisionPlataforma,'MXN')}</td></tr><tr style="background:#f1f5f9;"><td style="padding:12px;border:1px solid #cbd5e1;">${t.labelRetencionISR}</td><td style="padding:12px;border:1px solid #cbd5e1;text-align:right;color:#dc2626;">-${formatMoney(data.retencionISR,'MXN')}</td></tr><tr><td style="padding:12px;border:1px solid #cbd5e1;">${t.labelRetencionIVA}</td><td style="padding:12px;border:1px solid #cbd5e1;text-align:right;color:#dc2626;">-${formatMoney(data.retencionIVA,'MXN')}</td></tr>${data.ivaAdicional>0?`<tr style="background:#f1f5f9;"><td style="padding:12px;border:1px solid #cbd5e1;">${t.labelIVAAdicional}</td><td style="padding:12px;border:1px solid #cbd5e1;text-align:right;color:#dc2626;">-${formatMoney(data.ivaAdicional,'MXN')}</td></tr>`:''}<tr><td style="padding:12px;border:1px solid #cbd5e1;">ISH</td><td style="padding:12px;border:1px solid #cbd5e1;text-align:right;color:${data.tieneConvenio?'#059669':'#dc2626'};">${data.tieneConvenio?t.airbnbPaga:'-'+formatMoney(data.ishAPagar,'MXN')}</td></tr><tr style="background:#f1f5f9;"><td style="padding:12px;border:1px solid #cbd5e1;">Gastos</td><td style="padding:12px;border:1px solid #cbd5e1;text-align:right;color:#dc2626;">-${formatMoney(data.gastoLimpieza+data.gastoConsumibles,'MXN')}</td></tr><tr style="background:#10b981;"><td style="padding:14px;font-weight:700;color:#fff;font-size:15px;">${t.labelGananciaNeta}</td><td style="padding:14px;text-align:right;font-weight:700;font-size:18px;color:#fff;">${formatMoney(data.gananciaNeta,'MXN')}</td></tr></table><p style="margin-top:20px;font-size:11px;color:#6b7280;text-align:center;">anfitrion-mx.vercel.app</p></div>`;const tmp=document.createElement('div');tmp.innerHTML=html;tmp.style.cssText='position:absolute;left:-9999px;';document.body.appendChild(tmp);await html2pdf().set({margin:10,filename:'anfitrion-mx.pdf',image:{type:'jpeg',quality:0.98},html2canvas:{scale:2,backgroundColor:'#fff'},jsPDF:{unit:'mm',format:'a4',orientation:'portrait'}}).from(tmp.firstChild).save();document.body.removeChild(tmp);}catch(e){alert('Error: '+e.message);}finally{btn.disabled=false;btn.innerHTML='üìÑ '+TEXTS[currentLang].btnPdf;}}
        document.addEventListener('DOMContentLoaded',()=>{fetchTipoCambio();updateCreditDisplay();document.querySelectorAll('.lang-btn').forEach(b=>b.addEventListener('click',()=>{document.querySelectorAll('.lang-btn').forEach(x=>x.classList.remove('active'));b.classList.add('active');currentLang=b.dataset.lang;localStorage.setItem('anfitrion_lang',currentLang);updateLanguage();}));const sl=localStorage.getItem('anfitrion_lang');if(sl){currentLang=sl;document.querySelectorAll('.lang-btn').forEach(b=>b.classList.toggle('active',b.dataset.lang===currentLang));updateLanguage();}document.querySelectorAll('.currency-btn').forEach(b=>b.addEventListener('click',()=>{document.querySelectorAll('.currency-btn').forEach(x=>x.classList.remove('active'));b.classList.add('active');currentCurrency=b.dataset.currency;}));document.querySelectorAll('.platform-btn').forEach(b=>b.addEventListener('click',()=>{document.querySelectorAll('.platform-btn').forEach(x=>x.classList.remove('active'));b.classList.add('active');selectedPlatform=b.dataset.platform;}));document.getElementById('btnCalcular').addEventListener('click',calcular);document.getElementById('btnDescargarPDF').addEventListener('click',generatePDF);document.getElementById('btnDesglose').addEventListener('click',()=>{const wrapper=document.getElementById('desgloseWrapper'),t=TEXTS[currentLang];desgloseExpanded=!desgloseExpanded;wrapper.classList.toggle('expanded',desgloseExpanded);document.getElementById('btnDesgloseText').textContent=desgloseExpanded?t.btnDesgloseHide:t.btnDesglose;});document.getElementById('notaPVToggle').addEventListener('click',()=>{document.getElementById('notaPV').classList.toggle('open');});document.getElementById('notaPVLink').addEventListener('click',()=>{alert(TEXTS[currentLang].notaPVModal);});window.addEventListener('beforeinstallprompt',e=>{e.preventDefault();window.deferredPrompt=e;document.getElementById('installBanner').classList.add('show');});document.getElementById('installBtn').addEventListener('click',async()=>{if(window.deferredPrompt){window.deferredPrompt.prompt();const{outcome}=await window.deferredPrompt.userChoice;if(outcome==='accepted')document.getElementById('installBanner').classList.remove('show');window.deferredPrompt=null;}});if('serviceWorker'in navigator)navigator.serviceWorker.register('/sw.js');});
    </script>
</body>
</html>
